import{I as F}from"./delete.8f8fc61a.js";import{_ as S,o as g,c as p,b as t,u as E,f as L,i as a,m as U,r as f,a as I,w as C,F as D,v as M,l as B,t as P,k as V,d as j,x as q,y as H,z as J,q as k,A as O,B as K}from"../app.8de2ac0a.js";const Q={},R={t:"1639131683779",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3989",width:"64",height:"64"},W=t("path",{d:"M832.990625 494.253125","p-id":"3990"},null,-1),X=t("path",{d:"M567.659375 510.678125L894.134375 185.6375c15.440625-15.384375 15.525-40.275 0.16875-55.74375-15.384375-15.496875-40.246875-15.525-55.6875-0.16875L512.028125 454.821875 188.309375 129.865625C173.009375 114.48125 148.0625 114.425 132.65 129.78125 117.2375 145.165625 117.209375 170.1125 132.565625 185.553125l323.634375 324.871875L129.865625 835.26875c-15.440625 15.384375-15.525 40.275-0.16875 55.74375 7.678125 7.734375 17.803125 11.615625 27.928125 11.615625 10.040625 0 20.08125-3.825 27.759375-11.475l326.390625-324.928125 326.671875 327.909375C846.153125 901.896875 856.25 905.75 866.346875 905.75c10.06875 0 20.1375-3.853125 27.815625-11.503125 15.384375-15.384375 15.440625-40.275 0.084375-55.715625L567.659375 510.678125 567.659375 510.678125zM567.659375 510.678125","p-id":"3991"},null,-1),Y=[W,X];function Z(e,o){return g(),p("svg",R,Y)}const x=S(Q,[["render",Z]]),ee={}.VITE_APP_BASE_API+"/imageInfo/upload",oe={}.VITE_APP_CDN||"";function se(){return E.get("/imageGroup/list?pageSize=9999")}function te(e,o="",l=1,v=1,i=99999){return E.get(`/imageInfo/list?groupId=${e}&&imageName=${o}&&order=${l}&&pageNo=${v}&&pageSize=${i}`)}const ne=L({name:"ChooseImg",props:{groupId:{type:String,required:!0,default:-100}},components:{IconClose:x},setup(e,o){const l=a(!1),v=a(null),i=a(null),m=a(""),c=a(""),d=()=>{l.value=!1},s=n=>{m.value=n,y(n)},r=n=>{c.value=n},h=()=>{o.emit("update:setImage",c.value),d()},y=async n=>{const $=await te(n);i.value=$.data.data.records};return U(()=>e.groupId,async n=>{if(n=="")return;const $=await se();v.value=$.data.data.records,await y(n),m.value=e.groupId,l.value=!0},{immediate:!0}),{visible:l,groups:v,curGroup:m,curImg:c,imgList:i,closeDialog:d,changeGroup:s,changeImg:r,submitBg:h}}});const ae={key:0,class:"mask"},le={class:"dialog"},ie=j(" 图片选择 "),re={class:"content"},ue={class:"groups"},ce=["onClick"],de={class:"imgList"},ge=["onClick"],pe=["src"],me={class:"name"};function ve(e,o,l,v,i,m){const c=f("IconClose"),d=f("n-icon");return e.visible?(g(),p("div",ae,[t("div",le,[t("header",null,[ie,t("span",{class:"button-close",onClick:o[0]||(o[0]=(...s)=>e.closeDialog&&e.closeDialog(...s))},[I(d,{size:16},{default:C(()=>[I(c)]),_:1})])]),t("div",re,[t("ul",ue,[(g(!0),p(D,null,M(e.groups,s=>(g(),p("li",{key:s.id,class:B(e.curGroup==s.id&&"current"),onClick:r=>e.changeGroup(s.id)},P(s.groupName),11,ce))),128))]),t("ul",de,[(g(!0),p(D,null,M(e.imgList,s=>(g(),p("li",{key:s.id,onClick:r=>e.changeImg(s.imageUrl)},[t("div",{class:B(["img",e.curImg==s.imageUrl&&"current"])},[t("img",{src:s.imageUrl,alt:""},null,8,pe)],2),t("p",me,P(s.imageName),1)],8,ge))),128))])]),t("footer",null,[t("span",{onClick:o[1]||(o[1]=(...s)=>e.closeDialog&&e.closeDialog(...s))},"取消"),t("span",{class:"submit",onClick:o[2]||(o[2]=(...s)=>e.submitBg&&e.submitBg(...s))},"确认")])])])):V("",!0)}const _e=S(ne,[["render",ve],["__scopeId","data-v-02495e51"]]),fe=L({name:"GUploadImage",components:{IconDelete:F,ChooseImg:_e},props:{modelValue:{type:String,required:!0},groupId:{type:String,default:"0"},allowType:{type:String,default:"gif|jpeg|jpg|png"},size:{type:Number,default:2},action:{type:String,default:ee},previewHost:{type:String,default:oe},label:{type:String,default:""},inline:{type:[Boolean,String],default:!1},saveImg:{type:Boolean,default:!1}},setup(e,o){const l=q(),v=H(),i=a(!1),m=a({groupId:""}),c=a({}),d=a(!1),s=a(!1),r=a(""),h=a(""),y=async u=>{try{return i.value=!0,c.value={Authorization:localStorage.getItem("DataScreen-Token")},m.value.groupId=e.groupId,m.value.uuid="IMG"+new Date().getTime(),!0}catch(_){i.value=!1,l.error(_.message)}return!1},n=u=>{i.value=!1;const _=JSON.parse(u.event.target.response);o.emit("update:getGroupList",e.groupId),o.emit("update:toggleProject",e.groupId),_.code==200?(r.value=_.data,o.emit("update:getImg",_.data)):l.error(_.msg)},$=()=>{h.value="",setTimeout(()=>{h.value=e.groupId},50)},N=u=>{o.emit("update:getImg",u),r.value=u};J(async()=>{r.value=e.modelValue});const z=()=>{const u=new Image;u.src=e.modelValue,u.onload=()=>{d.value=!1},u.onerror=()=>{d.value=!0,e.modelValue}},G=()=>{e.modelValue&&(s.value=!0)},A=()=>{s.value=!1},T=()=>{const u=v.create({content:"确认删除图片？",negativeText:"取消",positiveText:"确定",title:"删除页面",showIcon:!1,onPositiveClick:async()=>{u.loading=!0;try{r.value="",o.emit("update:deleteImage")}catch(_){l.error(_.message)}}});s.value=!1};return U(()=>e.modelValue,z),{loading:i,form:m,iserr:d,visibleCover:s,beforeUpload:y,finishUpload:n,handleMouseEnter:G,handleMouseLeave:A,removeImage:T,token:c,imgSrc:r,changePic:$,copy_groupId:h,setImage:N}}});const b=e=>(O("data-v-400fce3b"),e=e(),K(),e),Ie={class:"datav-gui g-upload"},he={class:"g-upload-image-content"},ye=["src"],$e={key:1,class:"g-upload-tip"},Ce=b(()=>t("span",{style:{"margin-right":"5px",position:"relative",top:"42px"}},"上传 |",-1)),ke={key:0,class:"g-upload-image-cover"},we=b(()=>t("span",{style:{"margin-top":"2px","margin-right":"5px"}},"上传",-1)),Se=b(()=>t("span",null," | ",-1));function be(e,o,l,v,i,m){const c=f("IconDelete"),d=f("n-icon"),s=f("n-spin"),r=f("n-upload-dragger"),h=f("n-upload"),y=f("choose-img");return g(),p("div",Ie,[I(h,{accept:"image/*",action:e.action,multiple:!1,"show-file-list":!1,data:e.form,onBeforeUpload:e.beforeUpload,headers:e.token,onFinish:e.finishUpload},{default:C(()=>[I(r,null,{default:C(()=>[I(s,{show:e.loading},{default:C(()=>[t("div",{class:"g-upload-image-wrap",onMouseenter:o[3]||(o[3]=(...n)=>e.handleMouseEnter&&e.handleMouseEnter(...n)),onMouseleave:o[4]||(o[4]=(...n)=>e.handleMouseLeave&&e.handleMouseLeave(...n))},[t("div",he,[e.imgSrc?(g(),p("img",{key:0,src:e.imgSrc},null,8,ye)):(g(),p("div",$e,[Ce,t("span",{class:"changePic",style:{top:"42px",left:"114px"},onClick:o[0]||(o[0]=k((...n)=>e.changePic&&e.changePic(...n),["stop"]))},"选择")]))]),e.visibleCover?(g(),p("div",ke,[we,Se,t("span",{class:"changePic",onClick:o[1]||(o[1]=k((...n)=>e.changePic&&e.changePic(...n),["stop"]))},"更改"),t("span",{class:"button-span removeImage",onClick:o[2]||(o[2]=k((...n)=>e.removeImage&&e.removeImage(...n),["stop"]))},[I(d,{size:18},{default:C(()=>[I(c)]),_:1})])])):V("",!0)],32)]),_:1},8,["show"])]),_:1})]),_:1},8,["action","data","onBeforeUpload","headers","onFinish"]),I(y,{groupId:e.copy_groupId,"onUpdate:setImage":e.setImage},null,8,["groupId","onUpdate:setImage"])])}const w=S(fe,[["render",be],["__scopeId","data-v-400fce3b"]]);w.install=e=>{e.component(w.name,w)};export{w as default};
